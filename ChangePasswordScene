// Author: David Corrales Marco

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.io.PrintWriter;
import java.net.Socket;

import javafx.scene.control.Button;
import javafx.scene.control.Label;
import javafx.scene.control.PasswordField;
import javafx.scene.control.TextField;
import javafx.scene.layout.GridPane;

public class ChangePasswordScene extends SceneBasic
{
	PasswordField textOld = new PasswordField();//old password textfield
	PasswordField textNew = new PasswordField();//new password textfield
	private Label errorLabel;
	
	
	public ChangePasswordScene()
	{
		super("Change Password");
		GridPane display = new GridPane();//container holding the labels and textfeilds for old password and new password
		Label labelOld = new Label("Old Password: ");//label for old password texfield
		Label labelNew = new Label("New Password: ");//label for password textfield
		
		display.add(labelOld,0,0);
		display.add(labelNew,0,1);
		display.add(textOld,1,0);
		display.add(textNew,1,1);
		layout.getChildren().add(display);
		Button change = new Button("Change Password");//Change Password button

		change.setOnAction(e-> change());//sets change password button to test old password
		Button logout = new Button("Log Out");
		logout.setOnAction(e->SceneManager.setLoginScene());
		layout.getChildren().add(change);
		layout.getChildren().add(logout);
	}
	private void change() {
		
		try {
			Socket socket = SceneManager.getSocket();
			BufferedReader in = new BufferedReader(new InputStreamReader(socket.getInputStream()));
			PrintWriter out = new PrintWriter(SceneManager.getSocket().getOutputStream());
			
			out.println("CHANGE");
			out.println(textOld.getText());
			out.println(textNew.getText());
			out.flush();
			String message = in.readLine();
			
			if(message.equals("ADMIN")) {
				textOld.setText("");
				textNew.setText("");
				errorLabel = new Label("");
				SceneManager.setAdminScene();
			} else if(message.equals("CLIENT")) {
				textOld.setText("");
				textNew.setText("");
				errorLabel = new Label("");
				SceneManager.setClientScene();
			} else {
				errorLabel = new Label(message);
			}
			
		} catch (Exception e) {
			errorLabel = new Label("error: "+(e.toString()));
			e.printStackTrace();
		}
	}
	

}
